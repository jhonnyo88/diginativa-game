<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigiNativa Demo - Kommunal Onboarding</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .diginativa-main-container {
            max-width: 600px;
            margin: 2rem auto;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .progress-bar {
            background: linear-gradient(90deg, #10b981 var(--progress, 0%), #e5e7eb var(--progress, 0%));
            height: 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin: 0 0.25rem;
            transition: all 0.3s ease;
        }
        .step.active {
            background-color: #10b981;
            color: white;
        }
        .step.completed {
            background-color: #6b7280;
            color: white;
        }
        .step.pending {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .feedback-message {
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            animation: fadeIn 0.5s ease-in;
        }
        .feedback-success {
            background-color: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        .feedback-info {
            background-color: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .demo-api-response {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">DigiNativa Demo</h1>
            <p class="text-gray-600">AI-genererad kommunal onboarding modul - Testa funktionaliteten</p>
            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-blue-800 font-medium">ü§ñ Denna demo visar den kod som DigiNativa AI Team genererat fr√•n GitHub issue #25</p>
            </div>
        </header>

        <div id="react-demo"></div>

        <div class="mt-8 bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">üß™ API Demo - Progress Tracking</h2>
            <p class="text-gray-600 mb-4">Testa den AI-genererade API:n f√∂r att sp√•ra anv√§ndarframsteg:</p>
            
            <div class="flex gap-4 mb-4">
                <button id="api-track-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
                    Sp√•ra Framsteg (API Call)
                </button>
                <button id="api-get-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
                    H√§mta Anv√§ndardata (API Call)
                </button>
            </div>
            
            <div id="api-response" class="demo-api-response" style="display: none;">
                <strong>API Response:</strong>
                <pre id="api-result"></pre>
            </div>
        </div>

        <div class="mt-8 bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">üìä Testresultat f√∂r Johan</h2>
            <div id="test-results" class="space-y-3">
                <!-- Test results will be populated here -->
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Mock API functions (simulating the generated FastAPI endpoints)
        const mockAPI = {
            trackProgress: async (data) => {
                await new Promise(resolve => setTimeout(resolve, 500)); // Simulate network delay
                return {
                    success: true,
                    message: `Framsteg sparat f√∂r anv√§ndare ${data.user_id}`,
                    next_recommended_module: data.completion_percentage >= 100 ? "grundl√§ggande_digitalisering" : null
                };
            },
            getUserProgress: async (userId) => {
                await new Promise(resolve => setTimeout(resolve, 300));
                return {
                    user_id: userId,
                    total_completion: 65.0,
                    modules_completed: [
                        {
                            module_id: "intro",
                            completion_percentage: 100,
                            completed_at: new Date().toISOString()
                        },
                        {
                            module_id: "grundl√§ggande_digitalisering",
                            completion_percentage: 30,
                            started_at: new Date().toISOString()
                        }
                    ],
                    achievements: ["kommunal_nyb√∂rjare", "f√∂rsta_modulen_slutf√∂rd"],
                    last_activity: new Date().toISOString()
                };
            }
        };

        // Main React Component (based on generated MainContainer.tsx)
        function MainContainer() {
            const [currentStep, setCurrentStep] = useState(0);
            const [progress, setProgress] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [userResponses, setUserResponses] = useState({});

            const steps = [
                {
                    id: "intro",
                    title: "V√§lkommen",
                    content: "Introduktion till kommunal digitalisering"
                },
                {
                    id: "learning",
                    title: "L√§ra",
                    content: "Grundl√§ggande begrepp och verktyg"
                },
                {
                    id: "practice",
                    title: "√ñva",
                    content: "Praktiska √∂vningar"
                },
                {
                    id: "assessment",
                    title: "Bed√∂mning",
                    content: "Kunskapskontroll"
                },
                {
                    id: "completion",
                    title: "Klart",
                    content: "Gratulationer!"
                }
            ];

            const handleNext = async () => {
                if (currentStep < steps.length - 1) {
                    const newStep = currentStep + 1;
                    const newProgress = (newStep / (steps.length - 1)) * 100;
                    
                    setCurrentStep(newStep);
                    setProgress(newProgress);

                    // Simulate API call for progress tracking
                    try {
                        const response = await mockAPI.trackProgress({
                            user_id: "anna_kommun_demo",
                            module_id: steps[currentStep].id,
                            completion_percentage: newProgress
                        });
                        
                        setFeedback({
                            type: "success",
                            message: `‚úÖ ${response.message}`
                        });

                        // Update test results
                        updateTestResults("navigation", "‚úÖ Fungerar", "Anv√§ndaren kan navigera mellan steg");
                        
                    } catch (error) {
                        setFeedback({
                            type: "error", 
                            message: "‚ùå Fel vid sparning av framsteg"
                        });
                    }

                    // Clear feedback after 3 seconds
                    setTimeout(() => setFeedback(null), 3000);
                }
            };

            const handleAnswer = (questionId, answer) => {
                setUserResponses(prev => ({
                    ...prev,
                    [questionId]: answer
                }));
                
                setFeedback({
                    type: "info",
                    message: `üìù Svar registrerat: "${answer}"`
                });
                
                setTimeout(() => setFeedback(null), 2000);
                
                // Update test results
                updateTestResults("interaction", "‚úÖ Fungerar", "Anv√§ndaren kan svara p√• fr√•gor");
            };

            const renderStepContent = () => {
                const step = steps[currentStep];
                
                switch (step.id) {
                    case "intro":
                        return (
                            <div className="space-y-4">
                                <h3 className="text-lg font-semibold">V√§lkommen till DigiNativa! üëã</h3>
                                <p className="text-gray-600">
                                    Som kommunal anst√§lld kommer du att l√§ra dig anv√§nda digitala verktyg 
                                    f√∂r att f√∂rb√§ttra din arbetsvardag och servera medborgarna b√§ttre.
                                </p>
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <h4 className="font-medium text-blue-900">Vad kommer du att l√§ra dig?</h4>
                                    <ul className="list-disc list-inside text-blue-800 mt-2 space-y-1">
                                        <li>Grundl√§ggande digitala verktyg f√∂r kommunal verksamhet</li>
                                        <li>Effektiva arbetsmetoder f√∂r digitalisering</li>
                                        <li>Praktiska tips f√∂r att hj√§lpa medborgare</li>
                                    </ul>
                                </div>
                                <p className="text-sm text-gray-500">‚è±Ô∏è Uppskattat tid: 8-10 minuter</p>
                            </div>
                        );
                    
                    case "learning":
                        return (
                            <div className="space-y-4">
                                <h3 className="text-lg font-semibold">Grundl√§ggande Begrepp üìö</h3>
                                <div className="bg-gray-50 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">Digitalisering inom kommunen inneb√§r:</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="bg-white p-3 rounded border">
                                            <strong>Effektivitet</strong>
                                            <p className="text-sm text-gray-600">Snabbare handl√§ggning av √§renden</p>
                                        </div>
                                        <div className="bg-white p-3 rounded border">
                                            <strong>Tillg√§nglighet</strong>
                                            <p className="text-sm text-gray-600">24/7 service f√∂r medborgarna</p>
                                        </div>
                                        <div className="bg-white p-3 rounded border">
                                            <strong>Kvalitet</strong>
                                            <p className="text-sm text-gray-600">F√§rre fel och b√§ttre uppf√∂ljning</p>
                                        </div>
                                        <div className="bg-white p-3 rounded border">
                                            <strong>H√•llbarhet</strong>
                                            <p className="text-sm text-gray-600">Mindre papper och resande</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    
                    case "practice":
                        return (
                            <div className="space-y-4">
                                <h3 className="text-lg font-semibold">Praktisk √ñvning üí°</h3>
                                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                    <h4 className="font-medium text-yellow-900 mb-2">Scenario: En medborgare ringer</h4>
                                    <p className="text-yellow-800 mb-3">
                                        "Hej! Jag beh√∂ver hj√§lp med att ans√∂ka om bygglov f√∂r min altan. 
                                        Kan du hj√§lpa mig komma ig√•ng?"
                                    </p>
                                    <p className="font-medium text-yellow-900">Vilket √§r det b√§sta f√∂rsta steget?</p>
                                    <div className="mt-3 space-y-2">
                                        {[
                                            "H√§nvisa direkt till kommunens hemsida",
                                            "Fr√•ga vad medborgaren redan har f√∂rberett",
                                            "Boka ett fysiskt m√∂te p√• kommunhuset",
                                            "F√∂rklara hela processen √∂ver telefon"
                                        ].map((option, index) => (
                                            <button
                                                key={index}
                                                onClick={() => handleAnswer("scenario1", option)}
                                                className={`w-full text-left p-3 rounded border transition ${
                                                    userResponses.scenario1 === option
                                                        ? "bg-blue-100 border-blue-500"
                                                        : "bg-white border-gray-300 hover:bg-gray-50"
                                                }`}
                                            >
                                                {option}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        );
                    
                    case "assessment":
                        return (
                            <div className="space-y-4">
                                <h3 className="text-lg font-semibold">Kunskapskontroll ‚úÖ</h3>
                                <div className="space-y-4">
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <p className="font-medium mb-2">Vilka √§r de tre huvudf√∂rdelarna med digitalisering?</p>
                                        <div className="space-y-2">
                                            {[
                                                "Effektivitet, Tillg√§nglighet, Kvalitet",
                                                "Snabbhet, Billigare, Modernare",
                                                "Digital, Automatisk, Intelligent"
                                            ].map((option, index) => (
                                                <button
                                                    key={index}
                                                    onClick={() => handleAnswer("assessment1", option)}
                                                    className={`w-full text-left p-3 rounded border transition ${
                                                        userResponses.assessment1 === option
                                                            ? "bg-green-100 border-green-500"
                                                            : "bg-white border-gray-300 hover:bg-gray-50"
                                                    }`}
                                                >
                                                    {option}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    
                    case "completion":
                        return (
                            <div className="space-y-4 text-center">
                                <div className="text-6xl mb-4">üéâ</div>
                                <h3 className="text-lg font-semibold text-green-700">Gratulationer, Anna!</h3>
                                <p className="text-gray-600">
                                    Du har slutf√∂rt introduktionen till kommunal digitalisering. 
                                    Du √§r nu redo att hj√§lpa medborgarna √§nnu b√§ttre!
                                </p>
                                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                                    <h4 className="font-medium text-green-900 mb-2">Vad du har l√§rt dig:</h4>
                                    <ul className="text-green-800 text-sm space-y-1">
                                        <li>‚úÖ Grundl√§ggande digitalisering f√∂r kommuner</li>
                                        <li>‚úÖ Praktiska tillv√§gag√•ngss√§tt f√∂r medborgarservice</li>
                                        <li>‚úÖ Effektiva arbetsmetoder f√∂r digital transformation</li>
                                    </ul>
                                </div>
                                <p className="text-sm text-gray-500">
                                    üèÜ N√§sta modul: "Avancerad digital medborgarservice"
                                </p>
                            </div>
                        );
                    
                    default:
                        return <div>Laddar...</div>;
                }
            };

            // Update test results
            useEffect(() => {
                updateTestResults("loading", "‚úÖ Fungerar", "Applikationen laddas korrekt");
                updateTestResults("ui_display", "‚úÖ Fungerar", "Anv√§ndargr√§nssnittet visas korrekt");
            }, []);

            return (
                <div className="diginativa-main-container bg-white rounded-lg p-6">
                    {/* Progress Bar */}
                    <div className="mb-6">
                        <div className="flex justify-between items-center mb-2">
                            <h2 className="text-xl font-bold">Kommunal Onboarding</h2>
                            <span className="text-sm text-gray-600">{Math.round(progress)}% klart</span>
                        </div>
                        <div 
                            className="progress-bar"
                            style={{"--progress": `${progress}%`}}
                        ></div>
                    </div>

                    {/* Step Indicator */}
                    <div className="step-indicator">
                        {steps.map((step, index) => (
                            <div 
                                key={step.id}
                                className={`step ${
                                    index === currentStep ? 'active' : 
                                    index < currentStep ? 'completed' : 'pending'
                                }`}
                            >
                                <div className="text-xs font-medium">{step.title}</div>
                            </div>
                        ))}
                    </div>

                    {/* Feedback Message */}
                    {feedback && (
                        <div className={`feedback-message feedback-${feedback.type}`}>
                            {feedback.message}
                        </div>
                    )}

                    {/* Step Content */}
                    <div className="mt-6">
                        {renderStepContent()}
                    </div>

                    {/* Navigation */}
                    <div className="mt-6 flex justify-between">
                        <button 
                            onClick={() => {
                                if (currentStep > 0) {
                                    setCurrentStep(currentStep - 1);
                                    setProgress(((currentStep - 1) / (steps.length - 1)) * 100);
                                }
                            }}
                            disabled={currentStep === 0}
                            className="px-4 py-2 bg-gray-300 text-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-400 transition"
                        >
                            ‚Üê F√∂reg√•ende
                        </button>
                        
                        <button 
                            onClick={handleNext}
                            disabled={currentStep === steps.length - 1}
                            className="px-6 py-2 bg-blue-600 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 transition"
                        >
                            {currentStep === steps.length - 1 ? 'Slutf√∂rd!' : 'N√§sta ‚Üí'}
                        </button>
                    </div>
                </div>
            );
        }

        // Render the React component
        ReactDOM.render(<MainContainer />, document.getElementById('react-demo'));

        // API Demo functionality
        let testResults = {};

        function updateTestResults(testId, status, description) {
            testResults[testId] = { status, description, timestamp: new Date().toISOString() };
            
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = Object.entries(testResults).map(([id, result]) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded border">
                    <div>
                        <strong>${result.description}</strong>
                        <div class="text-sm text-gray-600">${id}</div>
                    </div>
                    <div class="text-right">
                        <div class="${result.status.includes('‚úÖ') ? 'text-green-600' : 'text-red-600'} font-medium">
                            ${result.status}
                        </div>
                        <div class="text-xs text-gray-500">
                            ${new Date(result.timestamp).toLocaleTimeString('sv-SE')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // API Demo button handlers
        document.getElementById('api-track-btn').addEventListener('click', async () => {
            const responseDiv = document.getElementById('api-response');
            const resultPre = document.getElementById('api-result');
            
            responseDiv.style.display = 'block';
            resultPre.textContent = 'Calling API...';
            
            try {
                const response = await mockAPI.trackProgress({
                    user_id: "anna_demo_test",
                    module_id: "intro",
                    completion_percentage: 75.0,
                    learning_objectives_met: ["f√∂rst√•_digitalisering", "anv√§nda_verktyg"]
                });
                
                resultPre.textContent = JSON.stringify(response, null, 2);
                updateTestResults("api_track", "‚úÖ Fungerar", "Progress tracking API svarar korrekt");
            } catch (error) {
                resultPre.textContent = `Error: ${error.message}`;
                updateTestResults("api_track", "‚ùå Fel", "Progress tracking API fel");
            }
        });

        document.getElementById('api-get-btn').addEventListener('click', async () => {
            const responseDiv = document.getElementById('api-response');
            const resultPre = document.getElementById('api-result');
            
            responseDiv.style.display = 'block';
            resultPre.textContent = 'Calling API...';
            
            try {
                const response = await mockAPI.getUserProgress("anna_demo_test");
                resultPre.textContent = JSON.stringify(response, null, 2);
                updateTestResults("api_get", "‚úÖ Fungerar", "User progress API svarar korrekt");
            } catch (error) {
                resultPre.textContent = `Error: ${error.message}`;
                updateTestResults("api_get", "‚ùå Fel", "User progress API fel");
            }
        });

        // Initial test results
        updateTestResults("demo_ready", "‚úÖ Redo", "Demo applikation startad och redo f√∂r testning");
    </script>
</body>
</html>